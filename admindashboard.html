<input type="date" id="subStart" placeholder="Start Date">
      <input type="number" id="subDuration" placeholder="Duration (days)">
      <input type="date" id="subEnd" placeholder="End Date">
      <input type="text" id="subCourses" placeholder="Courses (comma separated, blank for ALL)">
      <button type="submit">Save Subscription</button>
    </form>
  `

  // Hook subscription form
  document.getElementById('addSubForm').onsubmit = async (e) => {
    e.preventDefault()
    const email = document.getElementById('subEmail').value.trim().toLowerCase()
    const start = document.getElementById('subStart').value
    const duration = document.getElementById('subDuration').value
    const end = document.getElementById('subEnd').value
    const courses = document.getElementById('subCourses').value

    // Upsert subscription
    const { error } = await supabase.from('subscriptions').upsert([{
      email, 'start date': start, duration, 'end date': end, courses
    }])
    if(error) return alert("Error:" + error.message)
    fetchSubscriptions()
    alert("Subscription saved/updated!")
  }
}

// Edit subscription
window.editSub = function(email) {
  const row = Array.from(subscriptionsAdmin.querySelectorAll('tr')).find(tr=>tr.children[0]?.textContent===email)
  if(!row) return
  document.getElementById('subEmail').value = row.children[0].textContent
  document.getElementById('subStart').value = row.children[1].textContent
  document.getElementById('subDuration').value = row.children[2].textContent
  document.getElementById('subEnd').value = row.children[3].textContent
  document.getElementById('subCourses').value = row.children[4].textContent==="All" ? "" : row.children[4].textContent
}

// Delete subscription
window.deleteSub = async function(email) {
  if(confirm("Delete subscription for " + email + "?")) {
    const { error } = await supabase.from('subscriptions').delete().eq('email', email)
    if(error) return alert("Error: "+error.message)
    fetchSubscriptions()
  }
}

// Initial fetch
fetchVideos()
</script>
</body>
</html>
